{"version":3,"sources":["./src/app/pages/videocall-room/videocallroom.module.ts","./src/app/pages/videocall-room/videocallroom-routing.module.ts","./src/app/pages/videocall-room/videocallroom.component.ts","./src/app/pages/videocall-room/videocallroom.component.html"],"names":[],"mappings":"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","file":"videocall-room-videocallroom-module.js","sourcesContent":["import { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\n\nimport { VideoCallRoomRoutingModule } from './videocallroom-routing.module';\nimport { VideoCallRoomComponent } from './videocallroom.component';\nimport { SharedModule } from '../../shared/shared.module';\nimport { ComponentsModule } from '../../core/components/components.module';\n\n@NgModule({\n  declarations: [VideoCallRoomComponent],\n  imports: [\n    CommonModule,\n    VideoCallRoomRoutingModule,\n    ComponentsModule,\n    SharedModule\n  ]\n})\nexport class VideoCallRoomModule {}\n","import { NgModule } from '@angular/core';\nimport { Routes, RouterModule } from '@angular/router';\nimport { VideoCallRoomComponent } from './videocallroom.component';\n\nconst routes: Routes = [{ path: '', component: VideoCallRoomComponent }];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class VideoCallRoomRoutingModule {}\n","import { Component, OnDestroy, OnInit } from '@angular/core';\nimport { Router, ActivatedRoute } from '@angular/router';\nimport { Socket } from 'ngx-socket-io';\nimport { v4 as uuidv4 } from 'uuid';\n\ndeclare const Peer;\n\ninterface VideoElement {\n  muted: boolean;\n  srcObject: MediaStream;\n  userId: string;\n  userName: string;\n}\n\n@Component({\n  selector: 'back-office-videocallroom',\n  templateUrl: './videocallroom.component.html',\n  styleUrls: ['./videocallroom.component.scss']\n})\nexport class VideoCallRoomComponent implements OnInit, OnDestroy {\n  // User data.\n  currentUserId: string;\n  currentUserName: string;\n\n  // Room data.\n  roomId: string;\n  roomName: string;\n\n  // Media setup\n  micro: boolean;\n  camera: boolean;\n\n  // My connection stuff\n  myStream: MediaStream;\n  myPeer: any;\n\n  // Video components\n  videos: VideoElement[] = [];\n  videoSize = 12;\n\n  constructor(\n    private route: ActivatedRoute,\n    private socket: Socket,\n    private router: Router,\n  ) { }\n\n  ngOnInit(): void {\n    this.currentUserId = localStorage.getItem('roomId');\n    this.initializePeer();\n  }\n\n  ngOnDestroy(): void {\n    this.leaveRoom(this.roomId);\n  }\n\n  initializePeer(): void{\n    console.log(`Initialize Peer with id ${this.currentUserId}`);\n    const roomConfig = JSON.parse(localStorage.getItem('roomConfig'));\n    // Reading local storage.\n    this.roomName = roomConfig.name;\n    this.currentUserName = roomConfig.username;\n    this.micro = roomConfig.microphone;\n    this.camera = roomConfig.camera;\n    this.initializeIo();\n    this.initializeMedia();\n  }\n\n  initializeIo(): void {\n    this.myPeer = new Peer(this.currentUserId, {\n      url: 'https://test-app-peer.herokuapp.com'\n    });\n\n    this.route.params.subscribe((params) => {\n      console.log(params);\n\n      // Room identifier: from the url\n      // this.roomId = params.roomId;\n\n      this.myPeer.on('open', () => {\n        this.joinRoom(this.roomId);\n      });\n    });\n\n    this.socket.on('user-disconnected', (userId) => {\n      console.log(`receiving user-disconnected event from ${userId}`);\n      this.videos = this.videos.filter(video => video.userId !== userId);\n      this.videoSize = this.getVideoSize(this.videos.length);\n    });\n\n    this.socket.on('leave-room', (roomId, userId, { roomName, userName}) => {\n      console.log(`receiving leave-room  ${roomId} event from ${userId}`);\n      this.somebodyLeftRoom(roomId, userId, { roomName, userName });\n    });\n  }\n\n  initializeMedia(): void {\n    navigator.mediaDevices.getUserMedia({\n      audio: this.micro,\n      video: this.camera,\n    })\n      .catch((err) => {\n        console.error('[Error] Not able to retrieve user media:', err);\n        return null;\n      })\n      .then((stream: MediaStream | null) => {\n        if (stream) {\n          this.myStream = stream;\n          this.addMyVideo(stream);\n        }\n\n        // TODO: move all this code to another function because it is not related with the media itself.\n\n        this.myPeer.on('call', (call) => {\n          console.log('receiving call...', call);\n          call.answer(stream);\n\n          call.on('stream', (otherUserVideoStream: MediaStream) => {\n            console.log('receiving other stream', otherUserVideoStream);\n\n            this.addOtherUserVideo(call.metadata.userId, call.metadata.userName, otherUserVideoStream);\n          });\n\n          call.on('error', (err) => {\n            console.error(err);\n          });\n        });\n\n        this.socket.on('user-connected', (userId, { roomName, userName }) => {\n          console.log('Receiving user-connected event', `Calling ${userId} for ${roomName}`);\n\n          this.roomName = roomName;\n\n          // Let some time for new peers to be able to answer\n          setTimeout(() => {\n            const call = this.myPeer.call(userId, stream, {\n              metadata: {\n                userId: this.currentUserId,\n                userName: this.currentUserName\n              },\n            });\n            call.on('stream', (otherUserVideoStream: MediaStream) => {\n              console.log('receiving other user stream after his connection');\n              this.addOtherUserVideo(userId, userName, otherUserVideoStream);\n            });\n\n            call.on('close', () => {\n              this.videos = this.videos.filter((video) => video.userId !== userId);\n              this.videoSize = this.getVideoSize(this.videos.length);\n            });\n          }, 1000);\n        });\n      });\n  }\n\n  /**\n   * Current peer joins the selected room.\n   */\n  joinRoom(roomId: string): void {\n    this.socket.emit('join-room', roomId, this.currentUserId, {\n      userName: this.currentUserName,\n      roomName: this.roomName\n    });\n  }\n\n  /**\n   * Current peer leaves the selected room.\n   */\n  leaveRoom(roomId: string): void {\n    this.socket.emit('leave-room', roomId, this.currentUserId, {\n      userName: this.currentUserName,\n      roomName: this.roomName\n    });\n  }\n\n  /**\n   * Another user left a room.\n   */\n  somebodyLeftRoom(roomId: string, userId: string | null, { roomName, userName }): void {\n    console.log(`${userId} left ${roomId}`);\n    this.videos = this.videos.filter(video => video.userId !== userId);\n    this.videoSize = this.getVideoSize(this.videos.length);\n  }\n\n  addMyVideo(stream: MediaStream): void {\n    this.videos.push({\n      muted: true,\n      srcObject: stream,\n      userId: this.currentUserId,\n      userName: this.currentUserName + ' (You)',\n    });\n    this.videoSize = this.getVideoSize(this.videos.length);\n  }\n\n  addOtherUserVideo(userId: string, userName: string, stream: MediaStream): void {\n    const alreadyExisting = this.videos.some(video => video.userId === userId);\n    if (alreadyExisting) {\n      console.log(this.videos, userId);\n      return;\n    }\n    this.videos.push({\n      muted: false,\n      srcObject: stream,\n      userId,\n      userName,\n    });\n    this.videoSize = this.getVideoSize(this.videos.length);\n  }\n\n  onLoadedMetadata(event: Event): void {\n    (event.target as HTMLVideoElement).play();\n  }\n\n  showCam(): void{\n    console.log('show/hidde cam');\n    this.camera = !this.camera;\n    this.myStream.getVideoTracks()[0].enabled = this.camera;\n  }\n\n  muteMicro(): void{\n    console.log('mute/unmute micro');\n    this.micro = !this.micro;\n    this.myStream.getAudioTracks()[0].enabled = this.micro;\n  }\n\n  endCall(): void{\n    this.router.navigate([`/video-call`]);\n  }\n\n  getVideoSize(videos: number): number{\n    let videoSize = 12;\n    let cols = 1;\n    \n    if ( videos <= 2 ) {\n      cols = 1;\n    } else if ( videos === 3 ) {\n      cols = 2;\n    } else {\n      cols = videos === 1 ? 1 : Math.trunc(videos / 2);\n    }\n\n    videoSize = 12 / cols;\n    \n    return videoSize;\n  }\n}\n","<h1 class=\"section-header\">{{ roomName }}</h1>\n<div class=\"video-grid\">\n    <div class=\"p-grid p-d-flex p-jc-center videos\">\n        <ng-container *ngFor=\"let video of videos\">\n          <div class=\"video-content-current\" *ngIf=\"video.userId == currentUserId && videos?.length > 1; else userVideo\">\n            <span *ngIf=\"video.userId !== currentUserId; else currentUserVideoLabel\" class=\"name-label\">{{ video.userName }}</span>\n            <ng-template #currentUserVideoLabel>\n              <span class=\"name-label\">{{ video.userName }}</span>\n            </ng-template>\n            <video\n              [srcObject]=\"video.srcObject\"\n              (loadedmetadata)=\"onLoadedMetadata($event)\"\n              [muted]=\"video.muted\"\n            >\n            </video>\n          </div>\n          <ng-template #userVideo>\n            <div [class]=\"'video-content p-col-' + videoSize\">\n              <span *ngIf=\"video.userId !== currentUserId; else currentUserVideoLabel\" class=\"name-label\">{{ video.userName }}</span>\n              <ng-template #currentUserVideoLabel>\n                <span class=\"name-label\">{{ video.userName }}</span>\n              </ng-template>\n              <video\n                [srcObject]=\"video.srcObject\"\n                (loadedmetadata)=\"onLoadedMetadata($event)\"\n                [muted]=\"video.muted\"\n              >\n              </video>\n            </div>\n          </ng-template>\n        </ng-container>\n    </div>\n    <div class=\"p-d-flex p-jc-center button-container\">\n      <button type=\"button\" class=\"button-control\" id=\"show-cam\" name='show-cam' (click)=\"showCam()\">\n        <svg *ngIf=\"!camera; else cameraMuted\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"video-slash\" class=\"svg-inline--fa fa-video-slash fa-w-20 svg-icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\"><path fill=\"currentColor\" d=\"M633.8 458.1l-55-42.5c15.4-1.4 29.2-13.7 29.2-31.1v-257c0-25.5-29.1-40.4-50.4-25.8L448 177.3v137.2l-32-24.7v-178c0-26.4-21.4-47.8-47.8-47.8H123.9L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4L42.7 82 416 370.6l178.5 138c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.5-6.9 4.2-17-2.8-22.4zM32 400.2c0 26.4 21.4 47.8 47.8 47.8h288.4c11.2 0 21.4-4 29.6-10.5L32 154.7v245.5z\"></path></svg>\n        <ng-template #cameraMuted>\n          <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"video\" class=\"svg-inline--fa fa-video fa-w-18 svg-icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 576 512\"><path fill=\"currentColor\" d=\"M336.2 64H47.8C21.4 64 0 85.4 0 111.8v288.4C0 426.6 21.4 448 47.8 448h288.4c26.4 0 47.8-21.4 47.8-47.8V111.8c0-26.4-21.4-47.8-47.8-47.8zm189.4 37.7L416 177.3v157.4l109.6 75.5c21.2 14.6 50.4-.3 50.4-25.8V127.5c0-25.4-29.1-40.4-50.4-25.8z\"></path></svg>\n        </ng-template>\n      </button>\n      <button type=\"button\" class=\"button-control\" id=\"mute-micro\" name='mute-micro' (click)=\"muteMicro()\">\n        <svg *ngIf=\"!micro; else microMuted\" aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"microphone-slash\" class=\"svg-inline--fa fa-microphone-slash fa-w-20 svg-icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\"><path fill=\"currentColor\" d=\"M633.82 458.1l-157.8-121.96C488.61 312.13 496 285.01 496 256v-48c0-8.84-7.16-16-16-16h-16c-8.84 0-16 7.16-16 16v48c0 17.92-3.96 34.8-10.72 50.2l-26.55-20.52c3.1-9.4 5.28-19.22 5.28-29.67V96c0-53.02-42.98-96-96-96s-96 42.98-96 96v45.36L45.47 3.37C38.49-2.05 28.43-.8 23.01 6.18L3.37 31.45C-2.05 38.42-.8 48.47 6.18 53.9l588.36 454.73c6.98 5.43 17.03 4.17 22.46-2.81l19.64-25.27c5.41-6.97 4.16-17.02-2.82-22.45zM400 464h-56v-33.77c11.66-1.6 22.85-4.54 33.67-8.31l-50.11-38.73c-6.71.4-13.41.87-20.35.2-55.85-5.45-98.74-48.63-111.18-101.85L144 241.31v6.85c0 89.64 63.97 169.55 152 181.69V464h-56c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16z\"></path></svg>\n        <ng-template #microMuted>\n          <svg aria-hidden=\"true\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"microphone\" class=\"svg-inline--fa fa-microphone fa-w-11 svg-icon svg-icon-micro\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 352 512\"><path fill=\"currentColor\" d=\"M176 352c53.02 0 96-42.98 96-96V96c0-53.02-42.98-96-96-96S80 42.98 80 96v160c0 53.02 42.98 96 96 96zm160-160h-16c-8.84 0-16 7.16-16 16v48c0 74.8-64.49 134.82-140.79 127.38C96.71 376.89 48 317.11 48 250.3V208c0-8.84-7.16-16-16-16H16c-8.84 0-16 7.16-16 16v40.16c0 89.64 63.97 169.55 152 181.69V464H96c-8.84 0-16 7.16-16 16v16c0 8.84 7.16 16 16 16h160c8.84 0 16-7.16 16-16v-16c0-8.84-7.16-16-16-16h-56v-33.77C285.71 418.47 352 344.9 352 256v-48c0-8.84-7.16-16-16-16z\"></path></svg>\n        </ng-template>\n      </button>\n      <button type=\"button\" class=\"button-control button-control-endcall\" id=\"end-call\" name='end-call' (click)=\"endCall()\">\n        <svg aria-hidden=\"true\" width=\"20px\" height=\"20px\" focusable=\"false\" data-prefix=\"fas\" data-icon=\"phone-slash\" class=\"svg-inline--fa fa-phone-slash fa-w-20 svg-icon\" role=\"img\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 640 512\"><path fill=\"currentColor\" d=\"M268.2 381.4l-49.6-60.6c-6.8-8.3-18.2-11.1-28-6.9l-112 48c-10.7 4.6-16.5 16.1-13.9 27.5l24 104c2.5 10.8 12.1 18.6 23.4 18.6 100.7 0 193.7-32.4 269.7-86.9l-80-61.8c-10.9 6.5-22.1 12.7-33.6 18.1zm365.6 76.7L475.1 335.5C537.9 256.4 576 156.9 576 48c0-11.2-7.7-20.9-18.6-23.4l-104-24c-11.3-2.6-22.9 3.3-27.5 13.9l-48 112c-4.2 9.8-1.4 21.3 6.9 28l60.6 49.6c-12.2 26.1-27.9 50.3-46 72.8L45.5 3.4C38.5-2 28.5-.8 23 6.2L3.4 31.4c-5.4 7-4.2 17 2.8 22.4l588.4 454.7c7 5.4 17 4.2 22.5-2.8l19.6-25.3c5.4-6.8 4.1-16.9-2.9-22.3z\"></path></svg>\n      </button>\n    </div>\n</div>\n  "],"sourceRoot":"webpack:///"}